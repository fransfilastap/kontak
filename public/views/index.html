{{define "index"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kontak</title>
    <script src="https://unpkg.com/htmx.org@2.0.2"></script>
    <script src="https://unpkg.com/htmx-ext-sse@2.2.2/sse.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
            integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
<div id="loadingIndicator" style="display: block;">Loading...</div>
<div id="qrCode"></div>
<div hx-ext="sse" sse-connect="/wa-connect">
    <div style="display: none" sse-swap="QR_CONNECT" hx-trigger="sse:BeforeMessage"></div>
    <div sse-swap="CONNECTED"></div>
</div>
</body>
<script type="application/javascript">
    const loadingIndicator = document.getElementById('loadingIndicator');

    function setQRCode(event) {
        const qrCodeDiv = document.getElementById('qrCode');
        qrCodeDiv.innerHTML = '';
        new QRCode(qrCodeDiv, event.detail.data);
        loadingIndicator.style.display = 'none';
    }

    document.body.addEventListener('htmx:sseBeforeMessage', function (e) {
        if (e.type === "QR_CONNECT") {
            setQRCode(e);
        } else if (e.type === "CONNECTED") {
            loadingIndicator.style.display = 'none';
        }
    });
</script>
</html>
{{end}}